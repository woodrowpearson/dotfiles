# HomeAssistant Core Configuration
# Generated by Ansible - DO NOT EDIT MANUALLY

default_config:

# Text to speech
tts:
  - platform: google_translate

# Database Configuration
recorder:
  db_url: "postgresql://{{ homeassistant_db_user }}:{{ homeassistant_db_password }}@{{ homeassistant_db_host }}:{{ homeassistant_db_port }}/{{ homeassistant_db_name }}"
  purge_keep_days: {{ homeassistant_recorder_purge_keep_days }}
  commit_interval: {{ homeassistant_recorder_commit_interval }}

# HTTP Configuration
http:
  server_port: 8123
  use_x_forwarded_for: true
  trusted_proxies:
    {% for network in homeassistant_trusted_networks %}
    - {{ network }}
    {% endfor %}

# MQTT Configuration
{% if mqtt_enabled %}
mqtt:
  broker: mosquitto
  port: {{ mqtt_port }}
  username: {{ mqtt_user }}
  password: !secret mqtt_password
  discovery: true
  discovery_prefix: homeassistant
{% endif %}

# Zigbee2MQTT Integration
{% if zigbee2mqtt_enabled %}
mqtt:
  sensor:
    - name: "Zigbee2MQTT Bridge State"
      state_topic: "zigbee2mqtt/bridge/state"
      icon: mdi:zigbee
{% endif %}

# Frontend Configuration
frontend:
  themes: !include_dir_merge_named themes

# Lovelace UI
lovelace:
  mode: yaml
  resources:
    - url: /hacsfiles/lovelace-card-mod/card-mod.js
      type: module
    - url: /hacsfiles/mini-media-player/mini-media-player-bundle.js
      type: module
    - url: /hacsfiles/lovelace-mushroom/mushroom.js
      type: module

# Automation & Scripts
automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml

# Device Integrations
{% if homeassistant_custom_integrations %}
# Custom Integrations
{% for integration in homeassistant_custom_integrations %}
{% if integration.enabled %}
# {{ integration.name }} Integration
{% endif %}
{% endfor %}
{% endif %}

# Google Home Integration
google_assistant:
  project_id: !secret google_project_id
  service_account: !include google_service_account.json
  report_state: true
  exposed_domains:
    - switch
    - light
    - group
    - media_player
    - fan
    - climate

# Apple HomeKit Integration
homekit:
  filter:
    include_domains:
      - light
      - switch
      - fan
      - climate
      - media_player
  entity_config:
    media_player.living_room_tv:
      feature_list:
        - feature: on_off

# Philips Hue
hue:
  bridges:
    - host: !secret hue_bridge_ip
      allow_unreachable: true

# Network Discovery
discovery:
  ignore:
    - samsung_tv

# Cast Integration (Chromecast)
cast:
  media_player:
    - host: !secret chromecast_ip

# System Health
system_health:

# Logger Configuration
logger:
  default: {{ homeassistant_logger_level }}
  logs:
    homeassistant.core: debug
    custom_components: debug

# Person Tracking
person:

# Zone Configuration
zone:
  - name: Home
    latitude: !secret home_latitude
    longitude: !secret home_longitude
    radius: 100
    icon: mdi:home

# Device Tracker
device_tracker:
  - platform: nmap_tracker
    hosts: {{ ansible_default_ipv4.network }}/24
    home_interval: 10

# Input Helpers
input_boolean:
input_number:
input_select:
input_text:
input_datetime:

# Utility Meter
utility_meter:

# Template Sensors
template:
  - sensor:
      - name: "Mac Mini CPU Temperature"
        unit_of_measurement: "Â°C"
        state: "{{ states('sensor.mac_mini_cpu_temp') }}"
      - name: "Mac Mini Memory Usage"
        unit_of_measurement: "%"
        state: "{{ states('sensor.mac_mini_memory_percent') }}"

# Notifications
notify:
  - name: homeassistant_log
    platform: file
    filename: /config/home-assistant.log

# REST Commands for System Control
rest_command:
  restart_zigbee2mqtt:
    url: http://zigbee2mqtt:8080/api/restart
    method: POST

# Weather Integration
weather:
  - platform: met
    name: "Local Weather"