#!/bin/bash
# Configure macOS Dock with specific applications
# Generated by Ansible - DO NOT EDIT MANUALLY

set -euo pipefail

if [ "$(uname -s)" != "Darwin" ]; then
    exit 0
fi

echo "› Configuring macOS Dock with custom applications..."

# Clear all existing dock items
echo "  › Clearing existing dock items"
defaults write com.apple.dock persistent-apps -array

# Function to add application to dock
add_app_to_dock() {
    local app_path="$1"
    local app_name="$2"
    
    if [ -d "$app_path" ]; then
        echo "  › Adding $app_name to dock"
        defaults write com.apple.dock persistent-apps -array-add "<dict><key>tile-data</key><dict><key>file-data</key><dict><key>_CFURLString</key><string>$app_path</string><key>_CFURLStringType</key><integer>0</integer></dict></dict></dict>"
        return 0
    else
        echo "  › Warning: $app_name not found at $app_path"
        return 1
    fi
}

# Add specified applications in order
echo "  › Adding applications to dock..."

{% for app in dock_apps %}
# {{ app.name }}
{% if app.fallback_path is defined %}
if ! add_app_to_dock "{{ app.path }}" "{{ app.name }}"; then
    add_app_to_dock "{{ app.fallback_path }}" "{{ app.name }}" || true
fi
{% else %}
add_app_to_dock "{{ app.path }}" "{{ app.name }}" || true
{% endif %}

{% endfor %}

# Dock settings
echo "  › Configuring dock behavior..."

# Set dock size to 48 pixels (small but usable)
defaults write com.apple.dock tilesize -int 48

# Position dock on left side for more vertical space
defaults write com.apple.dock orientation -string "left"

# Disable dock autohide for quick access
defaults write com.apple.dock autohide -bool false

# Minimize windows using scale effect
defaults write com.apple.dock mineffect -string "scale"

# Remove recent applications from dock
defaults write com.apple.dock show-recents -bool false

# Don't automatically rearrange spaces based on most recent use
defaults write com.apple.dock mru-spaces -bool false

echo "  › Applying dock configuration..."
killall Dock

echo "› Dock configuration completed successfully"