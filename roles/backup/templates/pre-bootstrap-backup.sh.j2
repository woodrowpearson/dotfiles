#!/bin/bash
# Pre-Bootstrap Backup Hook
# Generated by Ansible - DO NOT EDIT MANUALLY

set -euo pipefail

# Colors
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

log() {
    echo -e "${BLUE}[$(date '+%Y-%m-%d %H:%M:%S')]${NC} $1"
}

success() {
    echo -e "${GREEN}✅ $1${NC}"
}

warning() {
    echo -e "${YELLOW}⚠️  $1${NC}"
}

# Check if backup system is available
if ! command -v backup-create >/dev/null 2>&1; then
    warning "Backup system not yet installed, skipping pre-bootstrap backup"
    exit 0
fi

log "Creating pre-bootstrap safety backup..."

# Create comprehensive pre-bootstrap backup
backup-create \
    --full \
    --name "pre-bootstrap" \
    --description "Safety backup before bootstrap process" \
    --include-system

success "Pre-bootstrap backup completed"

# Show backup status
echo
echo -e "${BLUE}📋 Backup Information:${NC}"
backup-list --recent 1 --details

echo
echo -e "${BLUE}💡 Recovery Information:${NC}"
echo "If something goes wrong during bootstrap, you can restore with:"
echo "  backup-restore --full pre-bootstrap"
echo "  backup-rollback emergency"
echo
echo "Or restore specific components:"
echo "  backup-restore --configs pre-bootstrap"
echo "  backup-restore --selective vscode pre-bootstrap"